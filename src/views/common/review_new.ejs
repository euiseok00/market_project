<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë¦¬ë·° ì‘ì„±</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f4f6f9; margin:0 }
    header { background:#007BFF; color:#fff; padding:14px 30px; display:flex; justify-content:space-between }
    .container { max-width:900px; margin:28px auto; background:#fff; padding:24px; border-radius:10px; box-shadow:0 6px 18px rgba(0,0,0,0.06) }
    .grid { display:grid; grid-template-columns: repeat(2, 1fr); gap:12px }
    .form-group { margin-bottom:14px }
    label{ display:block; margin-bottom:6px; font-weight:700 }
    select, textarea, input[type=text] { width:100%; padding:10px; border:1px solid #e2e8f0; border-radius:8px }
    .star-select { font-size:16px }
    .full-width { grid-column: 1 / -1 }
    button{ background:#007BFF; color:#fff; padding:10px 14px; border:none; border-radius:8px; font-weight:700 }
  </style>
</head>
<body>
  <header>
    <div>ğŸ® ê²Œì„ ë§ˆì¼“</div>
    <div>
      <% if (user) { %>
        <a href="/users/my_page" style="color:white; margin-right:12px"><%= user.id %></a>
        <a href="/auth/logout" style="color:white">ë¡œê·¸ì•„ì›ƒ</a>
      <% } else { %>
        <a href="/auth/login" style="color:white">ë¡œê·¸ì¸</a>
      <% } %>
    </div>
  </header>

  <div class="container">
    <h2>ë¦¬ë·° ì‘ì„±</h2>
    <form action="/reviews" method="post">
      <input type="hidden" name="game_id" value="<%= gameId %>">
      <div class="grid">
        <div class="form-group">
          <label for="rating_graphic">ê·¸ë˜í”½</label>
          <div class="stars" data-field="rating_graphic" aria-label="ê·¸ë˜í”½ ë³„ì ">
            <span class="star" data-value="1">â˜†</span>
            <span class="star" data-value="2">â˜†</span>
            <span class="star" data-value="3">â˜†</span>
            <span class="star" data-value="4">â˜†</span>
            <span class="star" data-value="5">â˜†</span>
          </div>
          <input type="hidden" name="rating_graphic" value="">
        </div>
        <div class="form-group">
          <label for="rating_quality">ì™„ì„±ë„</label>
          <div class="stars" data-field="rating_quality" aria-label="ì™„ì„±ë„ ë³„ì ">
            <span class="star" data-value="1">â˜†</span>
            <span class="star" data-value="2">â˜†</span>
            <span class="star" data-value="3">â˜†</span>
            <span class="star" data-value="4">â˜†</span>
            <span class="star" data-value="5">â˜†</span>
          </div>
          <input type="hidden" name="rating_quality" value="">
        </div>

        <div class="form-group">
          <label for="rating_fun">ì¬ë¯¸ / ëª°ì…ê°</label>
          <div class="stars" data-field="rating_fun" aria-label="ì¬ë¯¸/ëª°ì…ê° ë³„ì ">
            <span class="star" data-value="1">â˜†</span>
            <span class="star" data-value="2">â˜†</span>
            <span class="star" data-value="3">â˜†</span>
            <span class="star" data-value="4">â˜†</span>
            <span class="star" data-value="5">â˜†</span>
          </div>
          <input type="hidden" name="rating_fun" value="">
        </div>
        <div class="form-group">
          <label for="rating_replay">ë¦¬í”Œë ˆì´ ê°€ëŠ¥ì„±</label>
          <div class="stars" data-field="rating_replay" aria-label="ë¦¬í”Œë ˆì´ ê°€ëŠ¥ì„± ë³„ì ">
            <span class="star" data-value="1">â˜†</span>
            <span class="star" data-value="2">â˜†</span>
            <span class="star" data-value="3">â˜†</span>
            <span class="star" data-value="4">â˜†</span>
            <span class="star" data-value="5">â˜†</span>
          </div>
          <input type="hidden" name="rating_replay" value="">
        </div>

        <div class="form-group">
          <label for="rating_price">ê°€ê²© ë§Œì¡±ë„</label>
          <div class="stars" data-field="rating_price" aria-label="ê°€ê²© ë§Œì¡±ë„ ë³„ì ">
            <span class="star" data-value="1">â˜†</span>
            <span class="star" data-value="2">â˜†</span>
            <span class="star" data-value="3">â˜†</span>
            <span class="star" data-value="4">â˜†</span>
            <span class="star" data-value="5">â˜†</span>
          </div>
          <input type="hidden" name="rating_price" value="">
        </div>
        <div class="form-group">
          <label for="rating_first_impression">ì²«ì¸ìƒ</label>
          <div class="stars" data-field="rating_first_impression" aria-label="ì²«ì¸ìƒ ë³„ì ">
            <span class="star" data-value="1">â˜†</span>
            <span class="star" data-value="2">â˜†</span>
            <span class="star" data-value="3">â˜†</span>
            <span class="star" data-value="4">â˜†</span>
            <span class="star" data-value="5">â˜†</span>
          </div>
          <input type="hidden" name="rating_first_impression" value="">
        </div>

        <div class="form-group">
          <label for="rating_access">ì ‘ê·¼ì„±</label>
          <div class="stars" data-field="rating_access" aria-label="ì ‘ê·¼ì„± ë³„ì ">
            <span class="star" data-value="1">â˜†</span>
            <span class="star" data-value="2">â˜†</span>
            <span class="star" data-value="3">â˜†</span>
            <span class="star" data-value="4">â˜†</span>
            <span class="star" data-value="5">â˜†</span>
          </div>
          <input type="hidden" name="rating_access" value="">
        </div>
        <div class="form-group">
          <label for="rating_competitive">ê²½ìŸë ¥</label>
          <div class="stars" data-field="rating_competitive" aria-label="ê²½ìŸë ¥ ë³„ì ">
            <span class="star" data-value="1">â˜†</span>
            <span class="star" data-value="2">â˜†</span>
            <span class="star" data-value="3">â˜†</span>
            <span class="star" data-value="4">â˜†</span>
            <span class="star" data-value="5">â˜†</span>
          </div>
          <input type="hidden" name="rating_competitive" value="">
        </div>

        <div class="form-group full-width">
          <label for="comment">ë¦¬ë·° ë‚´ìš©</label>
          <textarea name="comment" id="comment" rows="8"></textarea>
        </div>
      </div>
      <div style="margin-top:10px;text-align:center">
        <button type="submit">ì €ì¥</button>
      </div>
    </form>
  </div>
    <div id="toast" style="position:fixed;right:20px;bottom:20px;display:none;background:#111;color:#fff;padding:14px 20px;border-radius:10px;box-shadow:0 12px 30px rgba(2,6,23,0.35);z-index:9999;min-width:220px;max-width:420px;font-size:16px;text-align:center"></div>

    <script>
      // star widget
      function initStars(){
        document.querySelectorAll('.stars').forEach(container => {
          const stars = Array.from(container.querySelectorAll('.star'));
          const hidden = container.nextElementSibling && container.nextElementSibling.tagName === 'INPUT' ? container.nextElementSibling : null;
          function setValue(v){
            stars.forEach(s => { s.textContent = (Number(s.dataset.value) <= v) ? 'â˜…' : 'â˜†'; s.classList.toggle('on', Number(s.dataset.value) <= v); });
            if (hidden) hidden.value = v || '';
          }
          stars.forEach(s => {
            s.addEventListener('click', ()=> setValue(Number(s.dataset.value)));
            s.addEventListener('mouseover', ()=> { const v = Number(s.dataset.value); stars.forEach(x=> x.textContent = (Number(x.dataset.value) <= v) ? 'â˜…' : 'â˜†'); });
            s.addEventListener('mouseout', ()=> { const v = Number(hidden && hidden.value) || 0; stars.forEach(x=> x.textContent = (Number(x.dataset.value) <= v) ? 'â˜…' : 'â˜†'); });
          });
        });
      }

      function showToast(msg){ const t = document.getElementById('toast'); t.textContent = msg; t.style.display='block'; clearTimeout(t._hid); t._hid=setTimeout(()=> t.style.display='none',2800); }

      async function postUrlEncoded(url,obj){ const body = Object.keys(obj).map(k=>encodeURIComponent(k)+'='+encodeURIComponent(obj[k])).join('&'); const res = await fetch(url,{method:'POST',headers:{'Content-Type':'application/x-www-form-urlencoded','X-Requested-With':'XMLHttpRequest','Accept':'application/json'},body}); const c = res.headers.get('content-type')||''; if (c.includes('application/json')) return { ok: res.ok, json: await res.json() }; return { ok: res.ok, text: await res.text() } }

      document.addEventListener('DOMContentLoaded', ()=>{
        initStars();
        const form = document.querySelector('form');
        if (!form) return;
        form.addEventListener('submit', async (e)=>{
          e.preventDefault();
          const data = {};
          new FormData(form).forEach((v,k)=>{ data[k]=v });
          const res = await postUrlEncoded(form.action, data);
          if (res.ok && res.json && res.json.success){
            showToast(res.json.message || 'ë¦¬ë·° ì‘ì„± ì™„ë£Œ');
            // optionally clear form
            // form.reset();
          } else {
            showToast((res.json && res.json.message) || res.text || 'ë¦¬ë·° ì €ì¥ ì‹¤íŒ¨');
          }
        });
      });
    </script>
</body>
</html>
