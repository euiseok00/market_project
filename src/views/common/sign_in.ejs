<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>게임 마켓 - 회원가입</title>
  <link rel="stylesheet" href="/css/common/sign_in.css" />
</head>
<body>
  <div class="signup-container">
    <h1>회원가입</h1>
    <% if (typeof error !== 'undefined' && error) { %>
      <div class="error"><%= error %></div>
    <% } %>
    <form id="signupForm" action="/users/sign_up" method="post">
      <div class="form-group">
        <label>아이디</label>
        <div class="id-check">
          <input id="inputId" name="id" type="text" placeholder="아이디 입력" required />
          <button id="checkIdBtn" type="button">중복확인</button>
        </div>
      </div>
      <div class="form-group">
        <label>비밀번호</label>
        <input name="password" type="password" placeholder="비밀번호 입력" required />
      </div>
      <div class="form-group">
        <label>비밀번호 확인</label>
        <input name="password_confirm" type="password" placeholder="비밀번호 재입력" required />
      </div>
      <button type="submit" class="submit-btn">회원가입 완료</button>
    </form>
    <a href="/auth/login" class="back-link">로그인으로 돌아가기</a>
  </div>
  <script>
    const checkBtn = document.getElementById('checkIdBtn');
    const inputId = document.getElementById('inputId');
    let idAvailable = false;

    checkBtn.addEventListener('click', async () => {
      const id = inputId.value.trim();
      if (!id) return alert('아이디를 입력하세요');
      try {
        const res = await fetch(`/users/check-id?id=${encodeURIComponent(id)}`);
        const j = await res.json();
        alert(j.message);
        idAvailable = j.available;
      } catch (e) {
        alert('서버 에러');
      }
    });

    document.getElementById('signupForm').addEventListener('submit', (e) => {
      const pw = document.querySelector('input[name="password"]').value;
      const pw2 = document.querySelector('input[name="password_confirm"]').value;
      if (pw !== pw2) {
        e.preventDefault();
        alert('비밀번호가 일치하지 않습니다.');
        return;
      }
      if (!idAvailable) {
        e.preventDefault();
        alert('아이디 중복확인을 해주세요.');
        return;
      }
    });
  </script>
</body>
</html>
